<!DOCTYPE html>
<html lang="br">
<head>
  
    <title>Laborat√≥rio Seguro para An√°lise de Malware - An√°lise de Malware 0x01 :: Midnight Hackings</title>
  
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content=" Escrito por: Mateus Gualberto (Midnight Reverser) - orgulho de escrever sem IA envolvida no processo!
Licen√ßa: livre, como todo conhecimento deve ser.
Introdu√ß√£o Nesse artigo ser√° apresentada uma abordagem para cria√ß√£o de um laborat√≥rio seguro local para an√°lise de artefatos suspeitos ou maliciosos. √â recomendado que o leitor siga o passo-a-passo na se√ß√£o Passo-a-passo √† risca, para evitar qualquer problema de configura√ß√£o
Para seguir a parte pr√°tica desse artigo, √© recomendado um computador de 64-bits Intel/AMD (arquitetura amd64/x86-64, n√£o funcionar√° bem nos hardwares ARM, como MacBooks M1), com pelo menos 8GB de RAM, e um software Hypervisor - recomendamos o Oracle VirtualBox. A virtualiza√ß√£o deve estar dispon√≠vel e obrigatoriamente ativa no computador que hospedar√° o laborat√≥rio.
" />
<meta name="keywords" content="midnight,blog,reverse-engineer,reversing" />

  <meta name="robots" content="noodp" />

<link rel="canonical" href="https://blog.midnighthackings.com/posts/malware-analysis-0x01/" />





  
  <link rel="stylesheet" href="https://blog.midnighthackings.com/css/buttons.min.86f6b4c106b6c6eb690ae5203d36b442c1f66f718ff4e8164fa86cf6c61ad641.css">

  
  <link rel="stylesheet" href="https://blog.midnighthackings.com/css/code.min.d529ea4b2fb8d34328d7d31afc5466d5f7bc2f0bc9abdd98b69385335d7baee4.css">

  
  <link rel="stylesheet" href="https://blog.midnighthackings.com/css/fonts.min.5bb7ed13e1d00d8ff39ea84af26737007eb5051b157b86fc24487c94f3dc8bbe.css">

  
  <link rel="stylesheet" href="https://blog.midnighthackings.com/css/footer.min.eb8dfc2c6a7eafa36cd3ba92d63e69e849e2200e0002a228d137f236b09ecd75.css">

  
  <link rel="stylesheet" href="https://blog.midnighthackings.com/css/gist.min.a751e8b0abe1ba8bc53ced52a38b19d8950fe78ca29454ea8c2595cf26aad5c0.css">

  
  <link rel="stylesheet" href="https://blog.midnighthackings.com/css/header.min.75c7eb0e2872d95ff48109c6647d0223a38db52e2561dd87966eb5fc7c6bdac6.css">

  
  <link rel="stylesheet" href="https://blog.midnighthackings.com/css/main.min.36833afd348409fc6c3d09d0897c5833d9d5bf1ff31f5e60ea3ee42ce2b1268c.css">

  
  <link rel="stylesheet" href="https://blog.midnighthackings.com/css/menu.min.3c17467ebeb3d38663dce68f71f519901124fa5cbb4519b2fb0667a21e9aca39.css">

  
  <link rel="stylesheet" href="https://blog.midnighthackings.com/css/pagination.min.bbb986dbce00a5ce5aca0504b7925fc1c581992a4bf57f163e5d69cc1db7d836.css">

  
  <link rel="stylesheet" href="https://blog.midnighthackings.com/css/post.min.e6dddd258e64c83e05cec0cd49c05216742d42fc8ecbfbe6b67083412b609bd3.css">

  
  <link rel="stylesheet" href="https://blog.midnighthackings.com/css/syntax.min.a0773cce9310cb6d8ed23e50f005448facf29a53001b57e038828daa466b25c0.css">

  
  <link rel="stylesheet" href="https://blog.midnighthackings.com/css/terminal.min.e3b0c44298fc1c149afbf4c8996fb92427ae41e4649b934ca495991b7852b855.css">

  
  <link rel="stylesheet" href="https://blog.midnighthackings.com/css/terms.min.b81791663c3790e738e571cdbf802312390d30e4b1d8dc9d814a5b5454d0ac11.css">


<link rel="stylesheet" href="https://blog.midnighthackings.com/terminal.css">




<link rel="shortcut icon" href="https://blog.midnighthackings.com/favicon.png">
<link rel="apple-touch-icon" href="https://blog.midnighthackings.com/apple-touch-icon.png">


<meta name="twitter:card" content="summary" />

  
    <meta name="twitter:site" content="" />
  
    <meta name="twitter:creator" content="" />



<meta property="og:locale" content="br" />
<meta property="og:type" content="article" />
<meta property="og:title" content="Laborat√≥rio Seguro para An√°lise de Malware - An√°lise de Malware 0x01">
<meta property="og:description" content=" Escrito por: Mateus Gualberto (Midnight Reverser) - orgulho de escrever sem IA envolvida no processo!
Licen√ßa: livre, como todo conhecimento deve ser.
Introdu√ß√£o Nesse artigo ser√° apresentada uma abordagem para cria√ß√£o de um laborat√≥rio seguro local para an√°lise de artefatos suspeitos ou maliciosos. √â recomendado que o leitor siga o passo-a-passo na se√ß√£o Passo-a-passo √† risca, para evitar qualquer problema de configura√ß√£o
Para seguir a parte pr√°tica desse artigo, √© recomendado um computador de 64-bits Intel/AMD (arquitetura amd64/x86-64, n√£o funcionar√° bem nos hardwares ARM, como MacBooks M1), com pelo menos 8GB de RAM, e um software Hypervisor - recomendamos o Oracle VirtualBox. A virtualiza√ß√£o deve estar dispon√≠vel e obrigatoriamente ativa no computador que hospedar√° o laborat√≥rio.
" />
<meta property="og:url" content="https://blog.midnighthackings.com/posts/malware-analysis-0x01/" />
<meta property="og:site_name" content="Midnight Hackings" />

  <meta property="og:image" content="https://blog.midnighthackings.com/og-image.png">

<meta property="og:image:width" content="1200">
<meta property="og:image:height" content="627">


  <meta property="article:published_time" content="2025-04-08 18:00:00 -0300 -03" />












</head>
<body>


<div class="container center">

  <header class="header">
  <div class="header__inner">
    <div class="header__logo">
      <a href="/">
  <div class="logo">
    Midnight Hackings
  </div>
</a>

    </div>
    
      <ul class="menu menu--mobile">
  <li class="menu__trigger">Menu&nbsp;‚ñæ</li>
  <li>
    <ul class="menu__dropdown">
      
        
          <li><a href="/posts">Postagens</a></li>
        
      
        
          <li><a href="/tags">Tags</a></li>
        
      
        
          <li><a href="https://github.com/midnight-rev">Github</a></li>
        
      
        
          <li><a href="/index.xml">RSS</a></li>
        
      
        
          <li><a href="/contact">Sobre</a></li>
        
      
      
        <hr />
        
          <li>
            <a href="https://blog.midnighthackings.com/">üáßüá∑ Brasileiro</a>
          </li>
        
      
    </ul>
  </li>
</ul>

    
    
      <ul class="menu menu--desktop menu--language-selector">
  <li class="menu__trigger">üáßüá∑ Brasileiro&nbsp;‚ñæ</li>
  <li>
    <ul class="menu__dropdown">
      
        <li><a href="https://blog.midnighthackings.com/">üáßüá∑ Brasileiro</a></li>
      
    </ul>
  </li>
</ul>

    
  </div>
  
    <nav class="navigation-menu">
  <ul class="navigation-menu__inner menu--desktop">
    
      
        
          <li><a href="/posts" >Postagens</a></li>
        
      
        
          <li><a href="/tags" >Tags</a></li>
        
      
        
          <li><a href="https://github.com/midnight-rev" >Github</a></li>
        
      
        
          <li><a href="/index.xml" >RSS</a></li>
        
      
        
          <li><a href="/contact" >Sobre</a></li>
        
      
      
    
  </ul>
</nav>

  
</header>


  <div class="content">
    
<article class="post">
  <h1 class="post-title">
    <a href="https://blog.midnighthackings.com/posts/malware-analysis-0x01/">Laborat√≥rio Seguro para An√°lise de Malware - An√°lise de Malware 0x01</a>
  </h1>
  <div class="post-meta"><time class="post-date">08/04/2025&nbsp;[Atualizado em 08/04/2025]</time><span class="post-reading-time">17 minuto(s) de leitura (3591 palavras)</span></div>

  
    <span class="post-tags">
      
      #<a href="https://blog.midnighthackings.com/tags/malware-research/">malware-research</a>&nbsp;
      
      #<a href="https://blog.midnighthackings.com/tags/trojans/">trojans</a>&nbsp;
      
    </span>
  
  


  
    <div class="table-of-contents">
      <h2>
        Sum√°rio
      </h2>
      <nav id="TableOfContents">
  <ul>
    <li><a href="#abordagem-0x00---laborat√≥rio-f√≠sico">Abordagem 0x00 - Laborat√≥rio f√≠sico</a></li>
    <li><a href="#abordagem-0x01---laborat√≥rio-virtual">Abordagem 0x01 - Laborat√≥rio virtual</a></li>
  </ul>

  <ul>
    <li><a href="#download-remnux">Download REMnux</a></li>
    <li><a href="#download-windows">Download Windows</a></li>
    <li><a href="#instala√ß√£o-das-ferramentas-e-configura√ß√£o-do-ambiente">Instala√ß√£o das ferramentas e configura√ß√£o do ambiente</a>
      <ul>
        <li><a href="#softwares-utilizados">Softwares utilizados</a></li>
        <li><a href="#configura√ß√£o-do-explorer">Configura√ß√£o do explorer</a></li>
        <li><a href="#desativa√ß√£o-windows-defender-no-windows-1011">Desativa√ß√£o Windows Defender no Windows 10/11</a></li>
        <li><a href="#desativa√ß√£o-do-firewall">Desativa√ß√£o do Firewall</a></li>
        <li><a href="#desativa√ß√£o-do-user-account-control">Desativa√ß√£o do User Account Control</a></li>
        <li><a href="#desativa√ß√£o-do-windows-update">Desativa√ß√£o do Windows Update</a></li>
      </ul>
    </li>
    <li><a href="#configura√ß√£o-da-rede">Configura√ß√£o da rede</a>
      <ul>
        <li><a href="#windows-malware">Windows Malware</a></li>
        <li><a href="#remnux">REMnux</a></li>
        <li><a href="#testando-a-configura√ß√£o">Testando a configura√ß√£o</a></li>
      </ul>
    </li>
    <li><a href="#snapshots">Snapshots</a></li>
  </ul>
</nav>
    </div>
  

  <div class="post-content"><div>
        <blockquote>
<p>Escrito por: Mateus Gualberto (Midnight Reverser) - <strong>orgulho de escrever sem IA envolvida no processo!</strong><br>
Licen√ßa: livre, como todo conhecimento deve ser.</p>
</blockquote>
<h1 id="introdu√ß√£o">Introdu√ß√£o<a href="#introdu√ß√£o" class="hanchor" ariaLabel="Anchor">#</a> </h1>
<p>Nesse artigo ser√° apresentada uma abordagem para cria√ß√£o de um laborat√≥rio seguro local para an√°lise de artefatos suspeitos ou maliciosos. √â recomendado que o leitor siga o passo-a-passo na se√ß√£o <a href="/posts/malware-analysis-0x01/#passo-a-passo">Passo-a-passo</a> √† risca, para evitar qualquer problema de configura√ß√£o</p>
<p>Para seguir a parte pr√°tica desse artigo, √© recomendado um computador de 64-bits Intel/AMD (arquitetura <code>amd64/x86-64</code>, n√£o funcionar√° bem nos hardwares ARM, como MacBooks M1), com pelo menos 8GB de RAM, e um software Hypervisor - recomendamos o <a href="https://www.virtualbox.org/wiki/Downloads">Oracle VirtualBox</a>. A virtualiza√ß√£o deve estar dispon√≠vel e obrigatoriamente ativa no computador que hospedar√° o laborat√≥rio.</p>
<p>O laborat√≥rio constru√≠do nesse artigo √© o alicerce para futuros artigos que tratar√£o da an√°lise de malwares reais, em especial para an√°lise din√¢mica de malwares Windows.</p>
<h1 id="laborat√≥rio-para-an√°lise-de-malwares">Laborat√≥rio para an√°lise de malwares<a href="#laborat√≥rio-para-an√°lise-de-malwares" class="hanchor" ariaLabel="Anchor">#</a> </h1>
<p>Primeiramente, o leitor deve estar se perguntando, mas o que seria um laborat√≥rio para an√°lise de malwares e por que eu devo ter um?</p>
<p>Um laborat√≥rio para an√°lise de malwares √© um ambiente isolado, reinici√°vel e sem liga√ß√£o com dados sens√≠veis ou importantes do analista/organiza√ß√£o (OPSEC), em que arquivos e comandos podem ser analisados est√°tica e dinamicamente de forma segura - sem afetar sua identidade nem comprometer os dados ou ativos da sua organiza√ß√£o.</p>
<p>Esse ambiente deve ser constru√≠do por qualquer profissional de seguran√ßa da informa√ß√£o ou pesquisador que tenha que lidar no cotidiano com arquivos suspeitos. Utiliz√°-lo trar√° mais seguran√ßa e confiabilidade ao trabalho desempenhado.</p>
<p><strong>N√£o necessariamente o pr√≥prio laborat√≥rio √© um ambiente seguro!</strong> A intera√ß√£o com ele sim deve ser segura, mas ele por si s√≥ tem fraquezas - como softwares vulner√°veis rodando; n√£o h√° nenhum software antiv√≠rus, firewalls e configura√ß√µes de seguran√ßa - como o <em>User Account Control</em> (UAC) nele. Qualquer arquivo &ldquo;esquecido&rdquo; ou encontrado ap√≥s um estado n√£o confi√°vel - como ap√≥s executar algum c√≥digo - deve ser tratado com extrema cautela. Em resumo, trate o ambiente como sempre infectado.</p>
<p>H√° duas abordagens principais para constru√ß√£o de laborat√≥rios seguros:</p>
<h2 id="abordagem-0x00---laborat√≥rio-f√≠sico">Abordagem 0x00 - Laborat√≥rio f√≠sico<a href="#abordagem-0x00---laborat√≥rio-f√≠sico" class="hanchor" ariaLabel="Anchor">#</a> </h2>
<p>Nesse cen√°rio, √© necess√°rio pelo menos uma m√°quina f√≠sica que ir√° executar os softwares maliciosos. Ela n√£o deve estar conectada √† rede local padr√£o de uso cotidiano, podendo estar conectada apenas em uma rede isolada ou sem conex√£o alguma. √â uma abordagem at√≠pica e menos utilizada.</p>
<p>‚úÖ Vantagens desse modelo:</p>
<ul>
<li>Malwares executar√£o em um computador real, logo qualquer medida anti-virtualiza√ß√£o ou anti-sandbox presentes n√£o ser√£o executadas. Isso permite rodar o malware como ele foi projetado para infectar uma m√°quina;</li>
<li>As m√°quinas utilizadas para an√°lise podem ser mais fracas, caso sejam utilizadas para tarefas de an√°lise menos intensivas e mais observacionais - como an√°lise comportamental.</li>
</ul>
<p>‚ùå Desvantagens:</p>
<ul>
<li>Necess√°rio aquisi√ß√£o de m√°quinas reais, como notebooks ou PCs, que ser√£o utilizadas apenas para a finalidade de an√°lise;</li>
<li>H√° custos, tamb√©m, com dispositivos de armazenamento externos, como SSDs, para restaura√ß√£o das imagens limpas ap√≥s infec√ß√£o;</li>
<li>A restaura√ß√£o das imagens √© um processo lento e que necessita de softwares especiais;</li>
<li>√â necess√°rio acesso f√≠sico ao laborat√≥rio - exceto caso seja realizado uma configura√ß√£o de VPN + Firewall rigorosos para libera√ß√£o de acesso externo.
<ul>
<li>Entretanto, mesmo nesse caso, a restaura√ß√£o do sistema necessitaria de acesso f√≠sico ao laborat√≥rio.</li>
</ul>
</li>
</ul>
<h2 id="abordagem-0x01---laborat√≥rio-virtual">Abordagem 0x01 - Laborat√≥rio virtual<a href="#abordagem-0x01---laborat√≥rio-virtual" class="hanchor" ariaLabel="Anchor">#</a> </h2>
<p>Nesse cen√°rio, um laborat√≥rio m√≠nimo pode ser criado atrav√©s da instala√ß√£o de uma m√°quina virtual Windows atrav√©s de um Hypervisor (residente em um computador &ldquo;host&rdquo;), que cont√©m todas as ferramentas, mas tem sua conex√£o de rede isolada ou desconectada totalmente. Essa configura√ß√£o √© a padr√£o utilizada por analistas de malware.</p>
<p>‚úÖ Vantagens de se construir um laborat√≥rio virtual:</p>
<ul>
<li>Custo baixo para constru√ß√£o, caso j√° se tenha um notebook/computador mediano (8GB de RAM e um bom processador). Licen√ßas do Windows podem n√£o ser necess√°rias caso se trabalhe com VMs pr√©-licenciadas ou utilize o per√≠odo de trial do Windows;</li>
<li>Isolamento das m√°quinas do laborat√≥rio e constru√ß√£o de redes facilitado;</li>
<li>Possibilidade de cria√ß√£o de snapshots - ou seja, capturas de um estado do Sistema Operacional, discos, configura√ß√µes, etc;</li>
<li>Possibilidade de migra√ß√£o do laborat√≥rio para outras m√°quinas, al√©m da mobilidade caso o laborat√≥rio esteja em um notebook;</li>
<li>Velocidade e facilidade em todos os sentidos: constru√ß√£o, restaura√ß√£o de estado limpo p√≥s-infec√ß√£o, dumps de mem√≥ria;</li>
<li>√â poss√≠vel criar uma configura√ß√£o avan√ßada mais facilmente com VPN + Firewall para acesso remoto seguro √†s VMs - ou at√© mesmo rodar o ambiente na nuvem. Com acesso tamb√©m ao host por um meio remoto seguro √© poss√≠vel gerenciar os snapshots facilmente e restaurar o ambiente sempre que necess√°rio.</li>
</ul>
<p>‚ùå Desvantagens:</p>
<ul>
<li>Rotinas anti-virtualiza√ß√£o e anti-sandbox ser√£o um problema que dever√° ser identificado e resolvido pelo analista de malware;</li>
<li>Caso o computador host seja muito antigo, rodar uma ou mais VMs pode levar a lentid√£o generalizada e at√© mesmo impossibilidade de rod√°-las.</li>
</ul>
<p>A abordagem virtual √© a que iremos seguir nesse artigo.</p>
<h1 id="arquitetura-do-laborat√≥rio-virtual">Arquitetura do laborat√≥rio virtual<a href="#arquitetura-do-laborat√≥rio-virtual" class="hanchor" ariaLabel="Anchor">#</a> </h1>
<p>Com o objetivo de complementar as an√°lises realizadas atrav√©s da emula√ß√£o de protocolos (para casos de an√°lise de troca de informa√ß√µes com o C2, por exemplo), torna-se necess√°rio adicionar uma m√°quina virtual a mais no laborat√≥rio, al√©m da m√°quina Windows. Adicionaremos  uma m√°quina GNU/Linux, tamb√©m isolada, mas inserida nesse ambiente e com conectividade para a m√°quina Windows.</p>
<blockquote>
<p>Por que n√£o fazer a an√°lise de pacotes de rede usando o pr√≥prio host v√≠tima? Para uma boa parte dos casos, n√£o h√° problemas em realizar a emula√ß√£o no pr√≥prio host - e existem ferramentas para isso, como o <a href="https://www.telerik.com/fiddler"><em>Fiddler</em></a>.</p>
<p>Entretanto, caso o malware aplique t√©cnicas que alterem como os pacotes s√£o enviados atrav√©s das APIs padr√£o (ou nem utilize-as), ferramentas de captura de pacotes podem n√£o ser suficientes para identificar e decodificar esses pacotes. Al√©m disso,  ferramentas para emula√ß√£o de servi√ßos e redirecionamento como o <em>fakenet</em>, <em>fakedns</em>, <em>inetsim</em> e muitas outras j√° t√™m vers√µes para Linux facilmente instal√°veis.</p>
</blockquote>

<img src="img/c93f228afa375892231e371d137ba91e.png"  class="center"  style="border-radius: 1px;"    />


<p>Nesse diagrama, temos a m√°quina Host, que executar√° um Hypervisor. Nesse hypervisor, teremos:</p>
<ul>
<li>Duas m√°quinas virtuais: uma Windows (Windows Malware), em que a maioria das an√°lises ser√£o realizadas, e uma Linux, em que servi√ßos ser√£o simulados e haver√° a captura de pacotes de rede. A distribui√ß√£o que utilizaremos para esse fim √© a REMnux, distro que conta com dezenas de ferramentas de an√°lise de malware;</li>
<li>Uma rede interna (VirtualBox) ou Host Only <strong>sem adaptador de rede no host</strong> (VMware, n√£o padr√£o, necess√°rio criar essa rede no gerenciador de redes). Essa rede ir√° interligar o host Windows com o Linux, mas n√£o permitir√° tr√°fego para o Host, a rede dom√©stica em que ele est√° inserido e √† Internet;</li>
</ul>
<h1 id="passo-a-passo">Passo-a-passo<a href="#passo-a-passo" class="hanchor" ariaLabel="Anchor">#</a> </h1>
<p>Nessa se√ß√£o ser√° mostrado um passo-a-passo para a constru√ß√£o e configura√ß√£o do laborat√≥rio no VirtualBox. √â necess√°rio que o leitor tenha conhecimento pr√©vio do processo de virtualiza√ß√£o, do hypervisor utilizado - caso queira utilizar outro que n√£o seja o VirtualBox - al√©m do processo de instala√ß√£o comum de um Sistema Operacional.</p>
<h2 id="download-remnux">Download REMnux<a href="#download-remnux" class="hanchor" ariaLabel="Anchor">#</a> </h2>
<p>O REMnux pode ser obtido <a href="https://docs.remnux.org/install-distro/get-virtual-appliance">por esse link</a>. Fa√ßa o download da OVA do VirtualBox e tenha certeza que a extens√£o do arquivo √© <em>.ova</em> antes de prosseguir para o pr√≥ximo passo.</p>

<img src="img/f6a8ed532389bb04d5d6d102b50db075.png"  class="center"  style="border-radius: 1px;"    />


<p>Ap√≥s obter a OVA, acesse a op√ß√£o <code>File &gt; Import Appliance</code> no VirtualBox e selecione a OVA. Deixe as op√ß√µes padr√£o em <em>Settings</em> durante a importa√ß√£o, ou, caso deseje, altere os valores de RAM e CPU. Conclua a importa√ß√£o e siga os pr√≥ximos passos.</p>

<img src="img/76986e183f0cfc9c38b5102c0797c1eb.png"  class="center"  style="border-radius: 1px;"    />



<img src="img/4ffdc497f0adeeb53630e71ebfedd0b9.png"  class="center"  style="border-radius: 1px;"    />


<h2 id="download-windows">Download Windows<a href="#download-windows" class="hanchor" ariaLabel="Anchor">#</a> </h2>
<p>Fa√ßa o download da ISO do Windows 10 atrav√©s <a href="https://www.microsoft.com/pt-br/software-download/windows10">desse link</a>. A p√°gina ir√° redirecionar para o download de uma ISO caso seu Sistema Operacional seja diferente de Windows, e para o download de um software criador de ISOs Windows, caso contr√°rio.</p>

<img src="img/88d8e6cfe5cd96d7bda005ff33956837.png"  class="center"  style="border-radius: 1px;"    />


<blockquote>
<p>Caso deseje, √© poss√≠vel utilizar Windows 11 - vantajoso devido a depreca√ß√£o do Windows 10 ainda esse ano. Por√©m, como veremos √† frente, a desativa√ß√£o do Windows Defender √© mais complexa no Windows 11, por isso que foi decidido a instala√ß√£o do Windows 10 nesse laborat√≥rio.</p>
</blockquote>
<p>Crie a m√°quina Windows como o de costume: configure a RAM, processadores e disco, e pule a instala√ß√£o desassistida. √â recomendado pelo menos 4GB de RAM, 2 processadores e 70GB de disco.</p>

<img src="img/147efefb7887a2ec3c3a5f916e6b0c41.png"  class="center"  style="border-radius: 1px;"    />



<img src="img/c690db07bc931576717e34936ddf5131.png"  class="center"  style="border-radius: 1px;"    />



<img src="img/94a639469b153423f2600f50de8db3e0.png"  class="center"  style="border-radius: 1px;"    />


<p>Siga a instala√ß√£o do Windows normalmente, por√©m n√£o fa√ßa login com uma conta Microsoft; crie uma conta local.</p>
<h2 id="instala√ß√£o-das-ferramentas-e-configura√ß√£o-do-ambiente">Instala√ß√£o das ferramentas e configura√ß√£o do ambiente<a href="#instala√ß√£o-das-ferramentas-e-configura√ß√£o-do-ambiente" class="hanchor" ariaLabel="Anchor">#</a> </h2>
<h3 id="softwares-utilizados">Softwares utilizados<a href="#softwares-utilizados" class="hanchor" ariaLabel="Anchor">#</a> </h3>
<p>A maior parte das nossas ferramentas ser√° instalada automaticamente atrav√©s do <a href="https://github.com/mentebinaria/retoolkit">projeto retoolkit</a>. Fa√ßa o download da release mais recente e execute o EXE.</p>
<blockquote>
<p>√â prov√°vel que o download seja marcado como n√£o seguro devido √† natureza das ferramentas contidas no pacote. Prossiga com a instala√ß√£o normalmente.</p>
</blockquote>
<p>A instala√ß√£o padr√£o j√° √© satisfat√≥ria para o laborat√≥rio. Caso queira mudar a localiza√ß√£o padr√£o da instala√ß√£o, recomendamos que seja colocado em <code>C:\retoolkit</code>, para facilitar a localiza√ß√£o das ferramentas.</p>

<img src="img/4e3390f5dd3148f1765faf82ec56cfc3.png"  class="center"  style="border-radius: 1px;"    />


<p>Al√©m do retoolkit, fa√ßa o download dos seguintes softwares:</p>
<ul>
<li>Regshot (<a href="https://sourceforge.net/projects/regshot/">https://sourceforge.net/projects/regshot/</a>)</li>
</ul>
<p>Extraia apenas o <em>Regshot-x64-Unicode.exe</em>, os demais n√£o s√£o necess√°rios.</p>

<img src="img/04d14bfae4905429729ad104892f75af.png"  class="center"  style="border-radius: 1px;"    />


<ul>
<li>Sysinternals (<a href="https://download.sysinternals.com/files/SysinternalsSuite.zip">https://download.sysinternals.com/files/SysinternalsSuite.zip</a>)</li>
</ul>
<p>Baixe e extraia os arquivos <em>Autoruns64.exe</em> e <em>Procmon64.exe</em>.</p>

<img src="img/fb20ba54138c8d342692efc82de87737.png"  class="center"  style="border-radius: 1px;"    />


<ul>
<li>Process Hacker System Informer (<a href="https://sourceforge.net/projects/systeminformer/files/systeminformer-3.2.25011-release-setup.exe/download">https://sourceforge.net/projects/systeminformer/files/systeminformer-3.2.25011-release-setup.exe/download</a>)</li>
</ul>
<p>Baixe e execute o instalador.</p>
<ul>
<li>Visual Studio Code (<a href="https://code.visualstudio.com/">https://code.visualstudio.com/</a>)</li>
</ul>
<p>Baixe e execute o instalador. O Visual Studio Code ajudar√° na constru√ß√£o de scripts simples durante a extra√ß√£o de configura√ß√£o de certos malwares, por exemplo.</p>
<p>Tamb√©m √© importante instalar pacotes de uma linguagem de programa√ß√£o, como o <a href="https://www.python.org/">Python</a>. Entretanto, sinta-se livre para instalar a(s) linguagem(ns) de programa√ß√£o que preferir.</p>
<h3 id="configura√ß√£o-do-explorer">Configura√ß√£o do explorer<a href="#configura√ß√£o-do-explorer" class="hanchor" ariaLabel="Anchor">#</a> </h3>
<p>Na configura√ß√£o do explorer, na aba <em>View</em>, √© interessante deixar todas as tr√™s checkboxes abaixo ativas, para mostrar as extens√µes dos arquivos e arquivos ocultos. Isso ajudar√° a identificar mais facilmente arquivos dropados.</p>

<img src="img/d59ab5d7bc517794b59b6be43a025e64.png"  class="center"  style="border-radius: 1px;"    />


<h3 id="desativa√ß√£o-windows-defender-no-windows-1011">Desativa√ß√£o Windows Defender no Windows 10/11<a href="#desativa√ß√£o-windows-defender-no-windows-1011" class="hanchor" ariaLabel="Anchor">#</a> </h3>
<p>A desativa√ß√£o do Windows Defender √© essencial para a an√°lise dos malwares. N√£o podemos deixar que um antiv√≠rus atrapalhe as an√°lises, remova nossas ferramentas e scripts e fa√ßa a√ß√µes autom√°ticas, como bloqueio e envio de arquivos suspeitos para a Microsoft.</p>
<h4 id="windows-10---desativa√ß√£o-via-gpeditmsc">Windows 10 - Desativa√ß√£o via gpedit.msc<a href="#windows-10---desativa√ß√£o-via-gpeditmsc" class="hanchor" ariaLabel="Anchor">#</a> </h4>
<p>Essa t√©cnica √© a mais comum para Windows 10, mas nem sempre funciona - provavelmente devido a certas configura√ß√µes gerados durante a instala√ß√£o/builds espec√≠ficas do SO.</p>
<p>Para usar essa t√©cnica:</p>
<ul>
<li>Pesquise por <em>gpedit.msc</em> no Windows, ou use Win+R para execut√°-lo diretamente;</li>
<li>Navegue em <em>Computer Configuration &gt; Administrative Templates &gt; Windows Components &gt; Microsoft Defender Antivirus</em> e deixe selecionado &ldquo;Microsoft Defender Antivirus&rdquo; - n√£o expanda-o;</li>
</ul>

<img src="img/02580f2a6cbfe5c02b78019087e68870.png"  class="center"  style="border-radius: 1px;"    />



<img src="img/39659239acbc373797e740f8da9b7466.png"  class="center"  style="border-radius: 1px;"    />


<ul>
<li>Clique duas vezes em &ldquo;Turn off Microsoft Defender Antivirus&rdquo; e deixe ativado;</li>
</ul>

<img src="img/bdc569ba9c5708cd92b04896d6292701.png"  class="center"  style="border-radius: 1px;"    />


<ul>
<li>Ap√≥s um reboot, verifique se as configura√ß√µes de &ldquo;Virus &amp; threat protection&rdquo; estejam desativadas, como na imagem abaixo.</li>
</ul>

<img src="img/511ce501c58b0f1d928104ac0e42504c.png"  class="center"  style="border-radius: 1px;"    />


<p>Caso a desativa√ß√£o n√£o funcione, √© recomend√°vel testar o m√©todo de <a href="/posts/malware-analysis-0x01/#windows-11-desativa√ß√£o-via-safe-boot">desativa√ß√£o no Windows 11</a>. Ele deve funcionar corretamente.</p>
<h4 id="windows-11---desativa√ß√£o-via-safe-boot">Windows 11 - Desativa√ß√£o via safe boot<a href="#windows-11---desativa√ß√£o-via-safe-boot" class="hanchor" ariaLabel="Anchor">#</a> </h4>
<p>Essa t√©cnica foi compartilhada pelo OALabs no seu v√≠deo de cria√ß√£o de um ambiente de an√°lise de malware em macs M1 (quem sabe, em breve, tenhamos um artigo sobre?). <a href="https://youtu.be/0eR8yrDLV5M?t=675&si=FKsJW2MuWuMRPaD6">Clique aqui</a> para acessar o v√≠deo na minutagem em que come√ßa a remo√ß√£o do Windows Defender.</p>
<p>Em resumo: essa t√©cnica consiste em mudar as permiss√µes de <code>C:\ProgramData\Microsoft\Windows Defender</code> para que ningu√©m, nem mesmo Administrators ou SYSTEM tenha acesso ao diret√≥rio, evitando o funcionamento correto do Windows Defender.</p>
<p>Segue o passo-a-passo:</p>
<p>Execute <em>msconfig.exe</em> e v√° na aba de Boot. Selecione <em>Safe boot</em> e clique em OK. Ap√≥s isso, reinicie o computador.</p>

<img src="img/ee28c6631df06f77f770874dbf1e8fdf.png"  class="center"  style="border-radius: 1px;"    />


<p>Quando a m√°quina reiniciar, ela n√£o ter√° carregado v√°rios drivers e o leitor ter√° um privil√©gio alto nos diret√≥rios sens√≠veis do Windows.</p>

<img src="img/24e5e7ce736193a062299132b3c1e12b.png"  class="center"  style="border-radius: 1px;"    />


<p>No explorer, v√° at√© <code>C:\ProgramData\Microsoft\</code>, selecione o diret√≥rio <code>Windows Defender</code> e clique em propriedades.</p>

<img src="img/036aabb666e3c03e173cedfafd7e150c.png"  class="center"  style="border-radius: 1px;"    />


<p>Na aba Security, clique em <em>Advanced</em>:</p>

<img src="img/bfc749aafa4445ad2b117df24672604b.png"  class="center"  style="border-radius: 1px;"    />


<p>Na janela que abrir, clique para mudar o Owner de <em>SYSTEM</em> para <em>Administrators</em> - ir√° abrir uma outra janela pedindo o nome do usu√°rio/grupo que ser√° o novo dono. Dessa forma, seu usu√°rio ter√° acesso de mudar as demais configura√ß√µes desse diret√≥rio.</p>

<img src="img/dbbca645ac430bd964b1e11aebb55ead.png"  class="center"  style="border-radius: 1px;"    />


<p>Ap√≥s isso, clique em <em>Replace all child object permission entries with inheritable permission entries from this object</em> e remova TODAS as permissions entries, inclusive dos Administrators. Isso resultar√° em erro de leitura/escrita pelo servi√ßo do Windows Defender, impedindo seu funcionamento.</p>

<img src="img/02517225a6bc731d0bad9c1f8e499365.png"  class="center"  style="border-radius: 1px;"    />


<p>Por fim, execute o <em>msconfig.exe</em> novamente, removendo o <em>Safe Boot</em> e reiniciando a m√°quina.</p>

<img src="img/9b854b4216e7f9299cf82939902f01d8.png"  class="center"  style="border-radius: 1px;"    />


<p>Ap√≥s reiniciar a m√°quina, verifique se o Windows Defender est√° ativo ainda, e caso esteja, siga para a pr√≥xima se√ß√£o.</p>
<h4 id="windows-1011---caso-nenhuma-outra-t√©cnica-funcione">Windows 10/11 - Caso nenhuma outra t√©cnica funcione&hellip;<a href="#windows-1011---caso-nenhuma-outra-t√©cnica-funcione" class="hanchor" ariaLabel="Anchor">#</a> </h4>
<p>Para essa t√©cnica que desenvolvi, torna-se necess√°rio executar o seguinte passo:</p>
<ul>
<li>Desative as seguintes op√ß√µes no &ldquo;Virus &amp; threat protection&rdquo; - em especial, a Tamper Protection;</li>
</ul>

<img src="img/9177be0fc2d905b5c9caba8f9a1b2ac2.png"  class="center"  style="border-radius: 1px;"    />


<p>Antes de analisar um malware, execute a seguinte linha em um PowerShell como administrador:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-powershell" data-lang="powershell"><span class="line"><span class="cl"><span class="k">while</span><span class="p">(</span><span class="vm">$true</span><span class="p">){</span><span class="nb">Set-MpPreference</span> <span class="n">-DisableRealtimeMonitoring</span> <span class="vm">$true</span><span class="p">;</span> <span class="nb">sleep </span><span class="mf">60</span><span class="p">}</span>
</span></span></code></pre></div><p>Essa op√ß√£o desativar√° o Windows Defender temporariamente, a cada 60 segundos, enquanto o processo do PowerShell que executar o comando continuar ativo. Ou seja, caso o processo seja encerrado por qualquer motivo, ou o computador reinicie, o Windows Defender ser√° reativado automaticamente. Esse √© o principal ponto negativo dessa t√©cnica.</p>
<p>Tamb√©m √© poss√≠vel adicionar todo o disco <code>C:\</code> na lista de diret√≥rios a n√£o serem varridos pelo Windows Defender - que √© uma t√©cnica efetiva para arquivos, mas certas funcionalidades antimalware, como o <a href="https://learn.microsoft.com/pt-br/windows/win32/amsi/antimalware-scan-interface-portal">AMSI</a>, continuar√£o ativas e detectando e bloqueando comandos maliciosos.</p>
<p>Uma √∫ltima op√ß√£o √© procurar por scripts, como <a href="https://github.com/ionuttbara/windows-defender-remover">esse</a>, que se prop√µem a realizar a remo√ß√£o for√ßada do Windows Defender. Para isso, √© necess√°rio pesquisar e estudar os efeitos colaterais dos scripts, bem como buscar uma vers√£o atualizada - muitos deles n√£o funcionam ap√≥s algumas releases do Windows.</p>
<h3 id="desativa√ß√£o-do-firewall">Desativa√ß√£o do Firewall<a href="#desativa√ß√£o-do-firewall" class="hanchor" ariaLabel="Anchor">#</a> </h3>
<p>O firewall padr√£o do Windows pode ser desativado facilmente atrav√©s da pesquisa pela palavra <em>firewall</em> no menu pesquisar e clicar em <em>Firewall &amp; network protection</em>.</p>

<img src="img/40b637fe2ac65252a622a82342fc9336.png"  class="center"  style="border-radius: 1px;"    />


<p>Desative o firewall para todos os tipos de rede que estiverem presentes:</p>

<img src="img/128d6be008e414c1903ad0deb9609147.png"  class="center"  style="border-radius: 1px;"    />


<h3 id="desativa√ß√£o-do-user-account-control">Desativa√ß√£o do User Account Control<a href="#desativa√ß√£o-do-user-account-control" class="hanchor" ariaLabel="Anchor">#</a> </h3>
<p>O UAC √© uma medida que requisita autoriza√ß√£o de um usu√°rio Administrador para a√ß√µes de alto privil√©gio no sistema - famoso por aquele prompt de sim/n√£o quando um software quer executar algo como administrador.</p>
<p>Para isso, pesquise por &ldquo;UAC&rdquo; no menu pesquisar do Windows, selecione &ldquo;User Account Control Settings&rdquo; e coloque &ldquo;Never notify&rdquo;. Confirme com OK.</p>

<img src="img/c836cd083878eb00e9a7b34eaad63bfc.png"  class="center"  style="border-radius: 1px;"    />


<h3 id="desativa√ß√£o-do-windows-update">Desativa√ß√£o do Windows Update<a href="#desativa√ß√£o-do-windows-update" class="hanchor" ariaLabel="Anchor">#</a> </h3>
<p>Para evitar problemas como a restaura√ß√£o do Windows Defender, √© interessante desativar o Windows Update. Isso tamb√©m ir√° diminuir tentativas de conex√£o aos servi√ßos Microsoft leg√≠timos na captura de pacotes. Caso o leitor tenha obtido suas ferramentas via <em>retoolkit</em> via instala√ß√£o padr√£o, o Windows Update j√° est√° desativado.</p>
<h2 id="configura√ß√£o-da-rede">Configura√ß√£o da rede<a href="#configura√ß√£o-da-rede" class="hanchor" ariaLabel="Anchor">#</a> </h2>
<p><strong>Muita aten√ß√£o √† essa parte!</strong> A configura√ß√£o correta da rede √© fundamental para a seguran√ßa do host e da rede dom√©stica em que ele est√° inserido. Em resumo, iremos configurar uma rede interna, sem acesso algum √† internet ou ao host. Isso significa que iremos mudar o adaptador de rede do hypervisor para uma rede interna (VirtualBox) ou hostonly <strong>configurada sem adaptador para o host</strong> (VMware).</p>
<p>Siga √† risca os passos para as VMs explicitados nas se√ß√µes que seguem para evitar problemas de seguran√ßa.</p>
<h3 id="windows-malware">Windows Malware<a href="#windows-malware" class="hanchor" ariaLabel="Anchor">#</a> </h3>
<p>No VirtualBox, selecione a VM Windows, clique em Settings e navegue at√© a aba &ldquo;Network&rdquo;:</p>

<img src="img/e03737c8dc50caa1fce8bdb17b6f65f3.png"  class="center"  style="border-radius: 1px;"    />


<p>Troque o tipo do adaptador 1 de &ldquo;NAT&rdquo; para &ldquo;Internal Network&rdquo;, e coloque um nome como <em>malware_internal</em> na sua rede. Clique em OK.</p>
<blockquote>
<p>No VirtualBox, quando se nomeia uma rede, ela √© criada automaticamente e fica dispon√≠vel para configura√ß√£o nas demais VMs.</p>
</blockquote>

<img src="img/3a1a26efd65cd6e51ea0889b2228596e.png"  class="center"  style="border-radius: 1px;"    />


<p>Execute o painel de controle do Windows e navegue at√© <em>Network and Internet &gt; Network and Sharing Center &gt; Change adapter settings</em>. Clique com o bot√£o direito no adaptador de Ethernet (deve ser o √∫nico que est√° conectado no ambiente) e clique em propriedades:</p>

<img src="img/37bd1418940bf66ba5d96c0db60219dc.png"  class="center"  style="border-radius: 1px;"    />


<p>Pesquise por <em>Internet Protocol Version 4 (TCP/IPv4)</em> e clique em propriedades:</p>

<img src="img/810e5f2e0eff72dd090531efa5398e5e.png"  class="center"  style="border-radius: 1px;"    />


<p>Coloque as exatas informa√ß√µes que est√£o na imagem abaixo na janela que abrir. Basicamente estamos definindo o IP do Windows como 172.16.0.2, e todo o tr√°fego dever√° ir para o gateway 172.16.0.1 (REMnux, que iremos configurar abaixo). Clique nos dois OKs ap√≥s configurar.</p>

<img src="img/8d9cad9deb3173b94b088e02404ef533.png"  class="center"  style="border-radius: 1px;"    />


<h3 id="remnux">REMnux<a href="#remnux" class="hanchor" ariaLabel="Anchor">#</a> </h3>
<p>Na REMnux, altere as configura√ß√µes do adaptador como feito na Windows. Nesse caso, a rede poder√° ser selecionada sem a necessidade da digita√ß√£o do nome dela novamente no campo <em>Name</em>.</p>

<img src="img/3f878c77c912efbdc383cccce38fc712.png"  class="center"  style="border-radius: 1px;"    />



<img src="img/6d37ba63db61e5bf4e61551a8d76bf7a.png"  class="center"  style="border-radius: 1px;"    />


<blockquote>
<p>Caso o layout do seu teclado seja o padr√£o brasileiro (ABNT/ABNT2), execute o comando  <code>setxkbmap br</code> em um terminal para configurar temporariamente o REMnux para utilizar esse padr√£o.</p>
</blockquote>
<p>Edite o arquivo <em>/etc/netplan/01-netcfg.yaml</em> com um editor de texto (pode utilizar o <em>nano</em> ou o <em>vim</em>, por exemplo). O arquivo deve se parecer com esse abaixo. Lembre-se de editar com privil√©gios root!</p>
<blockquote>
<p>Por exemplo, <code>sudo nano /etc/netplan/01-netcfg.yaml</code></p>
</blockquote>

<img src="img/a7293fc3a1bfaaa39818b3dc7063a663.png"  class="center"  style="border-radius: 1px;"    />


<p>O conte√∫do deve ser exatamente o seguinte - com exce√ß√£o do nome do adaptador, caso ele seja diferente do seu laborat√≥rio. Lembre-se de indentar corretamente com 2 espa√ßos ou o YAML poder√° n√£o ser lido com sucesso.</p>
<blockquote>
<p>Estamos definindo uma configura√ß√£o de rede est√°tica para nossa VM REMnux, em que ela ter√° o IP 172.16.0.1.</p>
</blockquote>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">network</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">version</span><span class="p">:</span><span class="w"> </span><span class="m">2</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">renderer</span><span class="p">:</span><span class="w"> </span><span class="l">networkd</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">ethernets</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">enp0s3</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">addresses</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="m">172.16.0.1</span><span class="l">/24]</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">gateway4</span><span class="p">:</span><span class="w"> </span><span class="m">172.16.0.1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">nameservers</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">addresses</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="m">172.16.0.1</span><span class="p">]</span><span class="w">
</span></span></span></code></pre></div><p>Exemplo da configura√ß√£o correta do arquivo est√° na imagem abaixo.</p>

<img src="img/71651f326bea807548985022e3d81db4.png"  class="center"  style="border-radius: 1px;"    />


<p>Por fim, execute o comando <code>sudo netplan apply</code> para aplicar as configura√ß√µes.</p>
<h3 id="testando-a-configura√ß√£o">Testando a configura√ß√£o<a href="#testando-a-configura√ß√£o" class="hanchor" ariaLabel="Anchor">#</a> </h3>
<p>Ap√≥s a configura√ß√£o realizada nas duas VMs, inicie as duas e abra um terminal/cmd nas duas e tente realizar um ping para o IP da outra (REMnux deve realizar o ping para 172.16.0.2 e o Windows para 172.16.0.1). Ele deve ser efetuado com sucesso, ou ent√£o h√° algum problema com sua configura√ß√£o.</p>

<img src="img/a7a1025f652f3c9410bf1c05744be511.png"  class="center"  style="border-radius: 1px;"    />


<h2 id="snapshots">Snapshots<a href="#snapshots" class="hanchor" ariaLabel="Anchor">#</a> </h2>
<p>Ap√≥s a instala√ß√£o correta das ferramentas, defini√ß√£o das configura√ß√µes e rede, seria muito chato rodar um malware nesse ambiente e ter que refazer todo o ambiente novamente, n√£o √© mesmo?</p>
<p>Para evitar isso, utilizaremos uma funcionalidade essencial para laborat√≥rios virtuais: <em>Snapshots</em>. Eles servem para salvar a m√°quina virtual, suas configura√ß√µes, sua RAM e seu contexto de execu√ß√£o em um dado momento. A partir da√≠, √© poss√≠vel retornar quando quiser a esse contexto, de maneira r√°pida e facilitada.</p>
<p>Para a an√°lise de malware, snapshots s√£o interessantes para salvar o estado inicial, limpo, apenas com as ferramentas e configura√ß√µes feitas, para que o laborat√≥rio sempre possa ser restaurado para um estado n√£o infectado facilmente. Al√©m disso, snapshots em pontos diferentes da an√°lise de um malware podem ser √∫teis para entender melhor o funcionamento de certas partes do c√≥digo malicioso, sempre podendo retornar a um estado anterior ou pr√≥ximo.</p>
<p>Nessa se√ß√£o, vamos fazer o snapshot do estado limpo que criamos para as VMs. √â poss√≠vel fazer o snapshot enquanto a m√°quina est√° rodando - e isso conta com vantagens na an√°lise, conforme explicado em <a href="/posts/malware-analysis-0x01/#medidas-adicionais">Medidas adicionais</a> - mas demorar√° mais tempo para ser criado e mais armazenamento.</p>
<p>Por esses motivos, faremos o snapshot desse primeiro estado com as VMs desligadas. Fica a cargo do leitor decidir se seguir√° dessa forma ou com a m√°quina ativa - n√£o h√° problemas de seguran√ßa quanto a isso.</p>
<p>Para realizar o snapshot, clique em qualquer VM do laborat√≥rio e ap√≥s isso clique no menu &ldquo;hamb√∫rguer&rdquo; que aparecer√° ao lado da VM selecionada. Selecione &ldquo;Snapshots&rdquo; para mostrar as informa√ß√µes e controles de snapshots para aquela VM na tela.</p>

<img src="img/0041c0292424e58119df73601ea5513f.png"  class="center"  style="border-radius: 1px;"    />


<p>Ap√≥s isso, clique em &ldquo;Take&rdquo; e nomeie o snapshot com algum nome que fa√ßa sentido - como &ldquo;main&rdquo; para o estado limpo, padr√£o da VM. Clique em OK.</p>

<img src="img/11af0a1b1a9ef4ad29dbc4c1773eb26e.png"  class="center"  style="border-radius: 1px;"    />


<p>Ap√≥s alguns segundos, o snapshot ser√° criado:</p>

<img src="img/febc47c9e03c55f585e687a1aa1e6d2f.png"  class="center"  style="border-radius: 1px;"    />


<p>Caso necessite restaurar o snapshot, clique no snapshot criado e em &ldquo;Restore&rdquo;. Fa√ßa isso sempre que terminar de analisar um malware ou desejar analisar v√°rios estados de um malware que est√£o em snapshots diferentes.</p>

<img src="img/6aa80aba8e2452e958dd2d56e9ba95a8.png"  class="center"  style="border-radius: 1px;"    />


<p>Fa√ßa o mesmo processo para a outra VM (REMnux ou Windows). Ap√≥s isso, o laborat√≥rio est√° 100% pronto para receber malwares!</p>
<h1 id="precau√ß√µes-de-uso-do-laborat√≥rio">Precau√ß√µes de uso do laborat√≥rio<a href="#precau√ß√µes-de-uso-do-laborat√≥rio" class="hanchor" ariaLabel="Anchor">#</a> </h1>
<p>As precau√ß√µes abaixo devem ser seguidas para evitar infec√ß√£o descontrolada, escape de malware para o host ou movimenta√ß√£o lateral na rede dom√©stica.</p>
<ul>
<li>
<p>N√£o adicione m√°quinas que n√£o s√£o para fins de an√°lise na mesma rede isolada do laborat√≥rio;</p>
</li>
<li>
<p>Elimine todas, ou a maioria, das conex√µes que existirem das m√°quinas do laborat√≥rios com seu host, como compartilhamento de arquivos em rede (NFS/SMB);</p>
</li>
<li>
<p>Compartilhamento de diret√≥rios via shared folders no hypervisor deve se dar com extrema cautela, e sempre que poss√≠vel, em apenas leitura. √â prefer√≠vel que uma m√°quina limpa do laborat√≥rio, n√£o infectada nem explorada, seja utilizada para obter arquivos de uma m√°quina infectada (como arquivos dropados), e ap√≥s isso passar dessa m√°quina limpa para o host;</p>
</li>
<li>
<p>Caso acesso a outras m√°quinas do laborat√≥rio ou √† Internet n√£o seja necess√°rio, desative o adaptador de rede virtual no hypervisor;</p>
</li>
<li>
<p>O acesso √† Internet deve ser extremamente restrito, e deve ser utilizado a rede Tor ou VPN com killswitch sempre que necess√°rio comunicar-se externamente;</p>
</li>
<li>
<p>N√£o utilize o laborat√≥rio para outros prop√≥sitos al√©m de analisar malware. <strong>N√£o coloque arquivos sens√≠veis no laborat√≥rio, ainda mais com acesso a Internet!</strong></p>
</li>
<li>
<p>Sempre atualize o hypervisor para evitar que vulnerabilidades de escape para o host sejam exploradas;</p>
</li>
</ul>
<h1 id="medidas-adicionais">Medidas adicionais<a href="#medidas-adicionais" class="hanchor" ariaLabel="Anchor">#</a> </h1>
<p>Para um laborat√≥rio eficiente, √© interessante que o ambiente seja moldado para parecer o m√≠nimo poss√≠vel com um laborat√≥rio. Para esse objetivo:</p>
<ul>
<li>
<p>Instale softwares comuns: pacote Office, browsers etc;</p>
</li>
<li>
<p>Navegue um pouco na internet, salve algumas senhas falsas no browser</p>
</li>
<li>
<p>Deixe a VM aberta um tempo e salve um snapshot live, para contabilizar tempo de uptime;</p>
</li>
<li>
<p>Instale softwares vulner√°veis, como o pacote Office sem corre√ß√£o para a vulnerabilidade <em>Follina</em>, para identificar mais facilmente a tentativa de explora√ß√£o de vulnerabilidades;</p>
</li>
<li>
<p>Crie/baixe arquivos comuns - notas, PDFs, imagens - n√£o sens√≠veis/cr√≠ticas;</p>
</li>
<li>
<p>Remova quaisquer ind√≠cios de virtualiza√ß√£o: dispositivos, drivers, arquivos espec√≠ficos, etc. A VM tamb√©m deve ter mais de um processador pois alguns malwares identificam laborat√≥rios de an√°lise pela quantidade de n√∫cleos de processamento;</p>
</li>
<li>
<p>Se poss√≠vel, altere as localiza√ß√µes padr√£o de instala√ß√£o dos softwares de an√°lise.</p>
</li>
</ul>
<p>Seu ambiente pode ser testado para demais t√©cnicas utilizadas por malwares em variados contextos (Debugging, Sandbox etc) atrav√©s do seguinte projeto:</p>
<ul>
<li><a href="https://github.com/ayoubfaouzi/al-khaser">https://github.com/ayoubfaouzi/al-khaser</a></li>
</ul>
<h1 id="conclus√£o">Conclus√£o<a href="#conclus√£o" class="hanchor" ariaLabel="Anchor">#</a> </h1>
<p>Nesse ponto, caso o leitor tenha seguido o passo-a-passo completo, ele ter√° consigo um laborat√≥rio simples e reinici√°vel e apto a realizar an√°lises de artefatos suspeitos e malwares, com possibilidade de simula√ß√£o de servi√ßos e captura de pacotes de rede de forma confi√°vel.</p>

      </div></div>

  
    
<div class="pagination">
  <div class="pagination__title">
    <span class="pagination__title-h">Ler outras postagens</span>
    <hr />
  </div>
  <div class="pagination__buttons">
    
    
    
      <a href="https://blog.midnighthackings.com/posts/malware-analysis-0x00/" class="button inline next">
         [<span class="button__text">Trojans: introdu√ß√£o, an√°lise, BinDiff!</span>] &gt;
      </a>
    
  </div>
</div>


  

  
    

  
</article>

  </div>

  
    <footer class="footer">
  <div class="footer__inner">
    
      <div class="copyright copyright--user">
        <span>Midnight Hackings apoia o fim da escala 6x1!</span>
    
      <span>:: <a href="https://github.com/panr/hugo-theme-terminal" target="_blank">Theme</a> made by <a href="https://github.com/panr" target="_blank">panr</a></span>
      </div>
  </div>
</footer>






<script type="text/javascript" src="/bundle.min.js"></script>





  
</div>

</body>
</html>
